> ここではmacOSにおけるNode.jsの環境構築方法を記載しています。
> 
> 「asdf」というバージョン管理ツールを使用してインストールします。
>
> ここから教材

# Node.jsの環境構築（macOS）
Webアプリケーションの開発を始めるにあたって、Node.jsをインストールしていきます。

もし既にお手元のPCにNode.jsの環境があれば、このパートは読み飛ばしても大丈夫です。

::: warn
注意）今回のパートで環境構築する対応のPCはmacOSになります。
:::

すでにNode.jsがインストールされているかどうかはコマンドで確認できます。

ターミナルを開いて以下のコマンドを入力してみましょう。

```console
node -v
```

以下のようにインストールされているNode.jsのバージョンが表示されれば、すでにインストール済みですので、本パートは読み飛ばしてください。

```
v14.17.5
```


## Homebrewのインストール
ソフトウェアの導入を簡単にするため、macOS用のパッケージ管理システムである**Homebrew**をインストールします。

すでにHomebrewがインストールされているかどうかは下記コマンドで確認できます。ターミナルを開いて下記コマンドを入力してみましょう。

```console
brew -v
```

下記のようにインストールされているHomebrewのバージョンが表示されれば、すでにインストール済みですので、次の「バージョン管理ツール 「asdf」 のインストール」の項へ進んでください。

```
Homebrew 3.2.7
Homebrew/homebrew-core (git revision 8c6c7476ac4; last commit 2021-08-17)
Homebrew/homebrew-cask (git revision 4d74f64d43; last commit 2021-08-17)
```

Homebrewがインストールされていない場合は、以下へ進んでください。

次のリンク先からHomebrewをインストールします。

[Homebrew](https://brew.sh/index_ja.html)

リンク先にアクセスすると次のページが表示されます。

![image](https://i.gyazo.com/069a774cc3f47cab32d7bed52e9b9bbf.png)

「インストール」の見出しの下にあるスクリプトの行をmacOSのターミナルにコピー＆ペーストします。

ターミナルで実行するとHomebrewのインストールが開始されます。

インストールには数分~10分ほどかかります。途中で何度かパスワードを要求されるので、使用しているパソコンのパスワードを入力してください。

## Homebrewのインストールを確認
Homebrewのインストール後に、無事にインストールされたかどうかを確認します。

インストール後の確認は、ターミナルを起動して次のコマンドを入力します。

```console
brew -v
```

入力をしたら`enter`キーを押して、コマンドを実行します。

コマンドが実行されると、次のような画面になります。

```
Homebrew 3.2.7
Homebrew/homebrew-core (git revision 8c6c7476ac4; last commit 2021-08-17)
Homebrew/homebrew-cask (git revision 4d74f64d43; last commit 2021-08-17)
```

「Homebrew 3.2.7」とバージョンが表示され、Homebrewがインストールされたことが確認できました。


## バージョン管理ツール 「asdf」 のインストール
バージョン管理ツールは、言語のバージョンを簡単に切り替えることができるツールです。

使っている環境全体のバージョンだけでなく、プロジェクトごとにバージョンを設定することもできます。

Node.jsでは「nvm」、Rubyでは「rbenv」など、それぞれの言語のバージョン管理ツールが用意されていますが、複数の管理ツールがあると、そのツール自体の管理にも手間がかかります。

そこで今回は、様々なプログラミング言語をまとめて管理できる**asdf**というツールをインストールします。

asdfはプログラミング言語だけでなく、MySQLやBundlerなどのツールのバージョンも管理することができます。

それではasdfをインストールしましょう。

ターミナルを開いて、以下のコマンドを実行してください。

```console
brew install asdf
```

インストールができたかどうか確認しましょう。

以下のコマンドを実行してください。

```console
asdf --version
```

以下のようにバージョンが表示されれば成功です。

```
v0.8.1
```

:::info
asdfをアップデートしたい場合は以下のコマンドを実行してください。

```console
brew upgrade asdf
```
:::

## asdfにPATHを通す
`asdf`コマンドを利用するために、**PATHを通す**という作業をします。

「PATHを通す」とは、コマンドの実行ファイルの場所を確認するために指定することです。

参考：[PATHを通すとは？（Mac OS X）](https://qiita.com/soarflat/items/09be6ab9cd91d366bf71)

それではPATHを通します。

以下のコマンドを実行してください。

```console
echo -e "\n. $(brew --prefix asdf)/libexec/asdf.sh" >> ~/.bash_profile
```

特にメッセージは表示されません。

次に`source`というコマンドを使って追加した内容を反映します。

```console
source ~/.bash_profile
```

`.bash_profile`に追加した内容を反映できました。

これでasdfコマンドを利用するのに必要なPATHが通りました。

## 必要なパッケージのインストール
Node.jsのインストールに必要なパッケージをHomebrewを利用してインストールします。

以下のコマンドを実行してください。

```console
brew install gpg gawk
```

インストールできたか確認します。

まず、以下のコマンドを実行して、gpgがインストールできたら確認してください。

```console
gpg --version
```

以下のようなメッセージが表示されればインストール成功です。

```
gpg (GnuPG) 2.3.1
・
・
・
```

続いてgawkの確認をします。

以下のコマンドを実行してください。

```console
gawk --version
```

以下のようなメッセージが表示されればインストール成功です。

```
GNU Awk 5.1.0, API: 3.0 (GNU MPFR 4.1.0, GNU MP 6.2.1)
・
・
・
```

続いて、Node.jsをインストールするのに必要なプラグインをインストールします。

以下のコマンドを実行してください。

```console
asdf plugin add nodejs https://github.com/asdf-vm/asdf-nodejs.git
```

以下のコマンドを実行して、プラグインがインストールできたか確認しましょう。

```console
asdf plugin list
```

以下のように表示されれば成功です。

```
nodejs
```

## Node.jsのインストール
今回はLTS（Long Term Support）と呼ばれる、長期サポートが保証されている最新のバージョンをインストールします。

以下のコマンドを実行してください。

```console
asdf install nodejs lts
```

インストールが完了すると、以下のようなメッセージが表示されます。

```
・
・
・
node-v14.17.5-darwin-x64.tar.gz: OK
Linking "lts" to "14.17.5"
```

Node.jsがインストールされたか確認しましょう。

下記のコマンドを入力してください。

```console
asdf list nodejs
```

以下のように`lts`と表示されれば成功です。

```
  14.17.5
  lts
```

## バージョンを設定する
先ほどインストールしたLTSバージョンを使用する設定をします。

バージョンの設定は、OS全体(グローバル)で同じバージョンを設定する方法と、プロジェクトごと(ローカル)に異なるバージョンを設定する方法があります。

ここではグローバルに設定する方法を説明します。

以下のコマンドを実行してください。

```console
asdf global nodejs lts
```

特にメッセージは表示されません。

バージョンが設定されたか確認しましょう。

以下のコマンドを実行してください。

```console
node -v
```

以下のようにバージョンが表示されれば成功です。

```
v14.17.5
```

以上でNode.jsの環境構築は完了です。

## バージョンの変更方法
LTSとなるバージョンは更新され続けるため、最新のバージョンを使用したい場合は、そのバージョンをインストールする必要があります。

また、プロジェクトによって使用するバージョンが異なることもよくあるため、ここではNode.jsのバージョンを変更する方法を説明します。

Node.jsの最新の情報は以下の公式ページを参照してください。

- [Node.js](https://nodejs.org/ja/)

### asdfのプラグインをアップデートする
Node.jsをインストールするのに必要なプラグインのアップデートをします。

以下のコマンドを実行してください。

```console
asdf plugin update nodejs
```

プラグインがアップデートされ、最新のNode.jsが利用できるようになります。

### 指定のバージョンをインストールする
インストールしたいバージョンが利用できるか確認します。

以下のコマンドを実行してください。

```console
asdf list all nodejs
```

以下のようにインストール可能なバージョンが表示されます。

```console
・
・
・
16.6.1
16.6.2
16.7.0
```

バージョンを確認したら、以下のコマンドを実行してください。

```console
asdf install nodejs <バージョン>
```

`<バージョン>`の箇所には`16.7.0`のように、インストールしたいバージョンを入力してください。

`<バージョン>`の箇所に`latest`を指定すると、最新のバージョンがインストールされます。

`lts`を指定すると、現時点でのLTSのバージョンがインストールされます。

コマンドを実行すると以下のようなメッセージが表示されます。

```
・
・
・
node-v16.7.0-darwin-x64.tar.gz: OK
```

インストールできているか確認しましょう。

以下のコマンドを実行してください。

```console
asdf list nodejs
```

以下のようにインストールしたバージョンが表示されていれば成功です。

```
  14.17.5
  16.7.0
  lts
```

### バージョンを設定する
インストールが完了したら、バージョンを使用する設定をしましょう。

グローバルに設定する場合は、以下のコマンドを実行してください。

```console
asdf global nodejs <バージョン>
```

ローカルに設定する場合は、設定したいプロジェクトのルートディレクトリに移動し、以下のコマンドを実行してください。

```console
asdf local nodejs <バージョン>
```

特にメッセージは表示されません。

バージョンが設定されたか確認しましょう。

以下のコマンドを実行してください。

```console
node -v
```

以下のように設定したバージョンが表示されれば成功です。

```
v16.7.0
```

以上でNode.jsのバージョン変更は完了です。

お疲れ様でした。
