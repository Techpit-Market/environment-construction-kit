> ここではmacOSにおけるPHPの環境構築方法を記載しています。
> 
> 「asdf」というバージョン管理ツールを使用してインストールします。
>
> バージョンは本キット作成時点で最新のバージョンである8.0.10をインストールします。
>
> カリキュラム執筆時にバージョンが更新されている場合は置き換えてください。
>
> ここから教材

# PHP8.0の環境構築（macOS）
Webアプリケーションの開発を始めるにあたって、PHPのバージョン8.0とPHPのパッケージ管理ツールであるComposerをインストールしていきます。

Composerを使用することで、自作のWebアプリケーションに便利なツールや機能を簡単に組み込むことができます。

もし既にお手元のPCにPHP8.0の環境とComposerがインストールされていれば、このパートは読み飛ばしても大丈夫です。

::: warn
本パートは macOS での環境構築方法を記載しています
:::

すでにPHP8.0がインストールされているかどうかはコマンドで確認できます。

ターミナルを開いて以下のコマンドを入力してみましょう。

```console
php -v
```

以下のようにインストールされているPHPのバージョンが8.0系であれば、PHPはインストール済みになります。

```
PHP 8.0.10 (cli) (built: Sep 11 2021 19:09:08) ( NTS )
Copyright (c) The PHP Group
Zend Engine v4.0.10, Copyright (c) Zend Technologies
```

Composerがインストールされているどうかは以下のコマンドで確認できます。

```console
composer --version
```

以下のようにバージョンが表示されていれば、Composerはインストール済みになります。

```
Composer version 2.1.6 2021-08-19 17:11:08
```

PHP8.0系とComposerがすでにインストールされている方は、本パートは読み飛ばしてください。

## Homebrewのインストール
ソフトウェアの導入を簡単にするため、macOS用のパッケージ管理システムである**Homebrew**をインストールします。

すでにHomebrewがインストールされているかどうかは下記コマンドで確認できます。ターミナルを開いて下記コマンドを入力してみましょう。

```console
brew -v
```

下記のようにインストールされているHomebrewのバージョンが表示されれば、すでにインストール済みですので、次の「バージョン管理ツール 「asdf」 のインストール」の項へ進んでください。

```
Homebrew 3.2.7
Homebrew/homebrew-core (git revision 8c6c7476ac4; last commit 2021-08-17)
Homebrew/homebrew-cask (git revision 4d74f64d43; last commit 2021-08-17)
```

Homebrewがインストールされていない場合は、以下へ進んでください。

次のリンク先からHomebrewをインストールします。

[Homebrew](https://brew.sh/index_ja.html)

リンク先にアクセスすると次のページが表示されます。

![image](https://i.gyazo.com/069a774cc3f47cab32d7bed52e9b9bbf.png)

「インストール」の見出しの下にあるスクリプトの行をmacOSのターミナルにコピー＆ペーストします。

ターミナルで実行するとHomebrewのインストールが開始されます。

インストールには数分~10分ほどかかります。途中で何度かパスワードを要求されるので、使用しているパソコンのパスワードを入力してください。

## Homebrewのインストールを確認
Homebrewのインストール後に、無事にインストールされたかどうかを確認します。

インストール後の確認は、ターミナルを起動して次のコマンドを入力します。

```console
brew -v
```

入力をしたら`enter`キーを押して、コマンドを実行します。

コマンドが実行されると、次のような画面になります。

```
Homebrew 3.2.7
Homebrew/homebrew-core (git revision 8c6c7476ac4; last commit 2021-08-17)
Homebrew/homebrew-cask (git revision 4d74f64d43; last commit 2021-08-17)
```

「Homebrew 3.2.7」とバージョンが表示され、Homebrewがインストールされたことが確認できました。


## バージョン管理ツール 「asdf」 のインストール
バージョン管理ツールは、言語のバージョンを簡単に切り替えることができるツールです。

使っている環境全体のバージョンだけでなく、プロジェクトごとにバージョンを設定することもできます。

PHPでは「phpenv」、Rubyでは「rbenv」など、それぞれの言語のバージョン管理ツールが用意されていますが、複数の管理ツールがあると、そのツール自体の管理にも手間がかかります。

そこで今回は、様々なプログラミング言語をまとめて管理できる**asdf**というツールをインストールします。

asdfはプログラミング言語だけでなく、MySQLやBundlerなどのツールのバージョンも管理することができます。

それではasdfをインストールしましょう。

ターミナルを開いて、以下のコマンドを実行してください。

```console
brew install asdf
```

インストールができたかどうか確認しましょう。

以下のコマンドを実行してください。

```console
asdf --version
```

以下のようにバージョンが表示されれば成功です。

```
v0.8.1
```

:::info
asdfをアップデートしたい場合は以下のコマンドを実行してください。

```console
brew upgrade asdf
```
:::

## asdfにPATHを通す
`asdf`コマンドを利用するために、**PATHを通す**という作業をします。

「PATHを通す」とは、コマンドの実行ファイルの場所を確認するために指定することです。

参考：[PATHを通すとは？（Mac OS X）](https://qiita.com/soarflat/items/09be6ab9cd91d366bf71)

それではPATHを通します。

以下のコマンドを実行してください。

```console
echo -e "\n. $(brew --prefix asdf)/libexec/asdf.sh" >> ~/.bash_profile
```

メッセージは表示されません。

次に`source`というコマンドを使って追加した内容を反映します。

```console
source ~/.bash_profile
```

`.bash_profile`に追加した内容を反映できました。

これでasdfコマンドを利用するのに必要なPATHが通りました。

## 必要なパッケージのインストール
PHP8.0のインストールに必要なパッケージをHomebrewを利用してインストールします。

```console
brew install autoconf automake bison freetype gd gettext icu4c krb5 libedit libiconv libjpeg libpng libxml2 libzip oniguruma pkg-config re2c zlib
```

続いて、PHPをインストールするのに必要なプラグインをインストールします。

以下のコマンドを実行してください。

```console
asdf plugin-add php https://github.com/asdf-community/asdf-php.git
```

以下のコマンドを実行して、プラグインがインストールできたか確認しましょう。

```console
asdf plugin list
```

以下のように表示されれば成功です。

```
php
```

## PHP8.0のインストール
今回は最新安定版のバージョンである8.0.10をインストールします。

以下のコマンドを実行してください。

```console
asdf install php 8.0.10
```

インストールが完了したら、以下のコマンドを実行して、インストールされたか確認しましょう。

```console
asdf list php
```

以下のように表示されればインストール成功です。

```
8.0.10
```

## バージョンを設定する
先ほどインストールしたPHP8.0を使用する設定をします。

バージョンの設定は、OS全体(グローバル)で同じバージョンを設定する方法と、プロジェクトごと(ローカル)に異なるバージョンを設定する方法があります。

ここではグローバルに設定する方法を説明します。

以下のコマンドを実行してください。

```console
asdf global php 8.0.10
```

特にメッセージは表示されません。

バージョンが設定されたか確認しましょう。

以下のコマンドを実行してください。

```console
php -v
```

以下のようにバージョン情報が表示されれば成功です。

```
PHP 8.0.10 (cli) (built: Sep 11 2021 19:09:08) ( NTS )
Copyright (c) The PHP Group
Zend Engine v4.0.10, Copyright (c) Zend Technologies
```

もし表示されない場合は、ターミナルを再起動して、再度`php -v`コマンドを実行してください。

続いてComposerもインストールされているか確認しましょう。

以下のコマンドを実行してください。

```console
composer --version
```

以下のようにバージョン情報が表示されれば成功です。

```console
Composer version 2.1.6 2021-08-19 17:11:08
```

以上でPHP8.0の環境構築は完了です。

## バージョンの変更方法
最新となるバージョンは更新され続けるため、最新のバージョンを使用したい場合は、そのバージョンをインストールする必要があります。

また、プロジェクトによって使用するバージョンが異なることもよくあるため、ここではPHPのバージョンを変更する方法を説明します。

PHPの最新の情報は以下の公式ページを参照してください。

- [PHP: Downloads](https://www.php.net/downloads.php)

### asdfのプラグインをアップデートする
まずはPHPをインストールするのに必要なプラグインのアップデートをします。

以下のコマンドを実行してください。

```console
asdf plugin update php
```

プラグインをアップデートすることで最新のPHPが利用できるようになります。

### 指定のバージョンをインストールする
まずはインストールしたいバージョンが利用できるか確認します。

以下のコマンドを実行してください。

```console
asdf list all php
```

以下のようにインストール可能なバージョンが表示されます。

```console
・
・
・
8.0.10
8.1.0alpha1
8.1.0alpha2
8.1.0alpha3
8.1.0beta1
8.1.0beta2
8.1.0beta3
```

`alpha`や`beta`が付いているバージョンは正式リリースされていないため、単にバージョン数が表示されているものをインストールしましょう。

バージョンを確認したら、以下のコマンドを実行してください。

```console
asdf install php {バージョン}
```

`{バージョン}`の箇所には`8.0.10`のように、インストールしたいバージョンを入力してください。

コマンドを実行し、インストールが終わったら、以下のコマンドを実行してインストールできているか確認しましょう。

```console
asdf list php
```

以下のようにインストールしたバージョンが表示されていれば成功です。

```
8.0.10
```

### バージョンを設定する
インストールが完了したら、バージョンを使用する設定をしましょう。

グローバルに設定する場合は、以下のコマンドを実行してください。

```console
asdf global php <バージョン>
```

ローカルに設定する場合は、設定したいプロジェクトのルートディレクトリに移動し、以下のコマンドを実行してください。

```console
asdf local php <バージョン>
```

特にメッセージは表示されません。

バージョンが設定されたか確認しましょう。

以下のコマンドを実行してください。

```console
php -v
```

以下のように設定したバージョン情報が表示されれば成功です。

```
PHP 8.0.10 (cli) (built: Sep 11 2021 19:09:08) ( NTS )
Copyright (c) The PHP Group
Zend Engine v4.0.10, Copyright (c) Zend Technologies
```

以上でPHPのバージョン変更は完了です。

お疲れ様でした。
